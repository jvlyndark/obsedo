<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Obsedo</title>
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='styles.css') }}"
    />
  </head>
  <body>
    <h1>Obsedo</h1>

    <!-- Future feature: AI-powered task planning -->
    <form id="goal-form" style="opacity: 0.4" disabled>
      <input
        type="text"
        id="goal"
        placeholder="Confess your goal..."
        disabled
      />
      <button type="submit" disabled>Submit to Obsedo</button>
    </form>
    <small style="color: gray"
      >AI task planner coming soon. For now, add tasks manually below.</small
    >

    <ul id="task-list"></ul>

    <script>
      const list = document.getElementById("task-list");

      document
        .getElementById("goal-form")
        .addEventListener("submit", async (e) => {
          e.preventDefault();
          const goal = document.getElementById("goal").value;
          const res = await fetch("/generate-tasks", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ goal }),
          });

          const data = await res.json();
          const list = document.getElementById("task-list");
          list.innerHTML = "";

          if (res.ok && Array.isArray(data)) {
            data.forEach((task) => {
              const li = document.createElement("li");
              li.innerHTML = `
              <strong>${task.title}</strong><br>
              <small>Category: ${task.category} | Priority: ${task.priority}</small><br>
              <button data-id="${task.id}" class="complete-btn">Mark Complete</button>
              `;
              list.appendChild(li);
            });
          } else {
            const li = document.createElement("li");
            li.innerHTML = `<span style="color:red;">Error: ${
              data.error || "Unknown error"
            }</span>`;
            list.appendChild(li);
          }
        });

      list.addEventListener("click", async (e) => {
        if (e.target.classList.contains("complete-btn")) {
          const taskId = e.target.getAttribute("data-id");

          const res = await fetch(`/tasks/${taskId}/complete`, {
            method: "PATCH",
          });

          if (res.ok) {
            e.target.parentElement.style.opacity = 0.4;
            e.target.remove();
          }
        }
      });
    </script>
  </body>
</html>
